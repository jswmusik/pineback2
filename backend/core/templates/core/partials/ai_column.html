<!-- AI Twin Column Content -->
<div id="ai-column-inner" class="flex flex-col h-full">
    
    <!-- Header with Sync Button -->
    <div class="p-4 border-b border-zinc-800">
        <div class="flex items-center justify-between mb-3">
            <div class="flex items-center gap-2">
                <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-emerald-500/20 to-teal-500/20 border border-emerald-500/30 flex items-center justify-center">
                    <svg class="w-4 h-4 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                    </svg>
                </div>
                <div>
                    <h3 class="text-sm font-semibold text-zinc-200">AI Twin</h3>
                    <p class="text-xs text-zinc-500">LLM-Optimized</p>
                </div>
            </div>
            
            {% if doc %}
            <button hx-post="{% url 'sync_ai_twin' doc.id %}"
                    hx-target="#ai-column-inner"
                    hx-swap="innerHTML"
                    hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'
                    hx-indicator="#sync-spinner"
                    class="group flex items-center gap-2 px-3 py-1.5 rounded-lg bg-emerald-500/10 hover:bg-emerald-500/20 border border-emerald-500/30 text-emerald-400 text-xs font-medium transition-all">
                <svg id="sync-icon" class="w-3.5 h-3.5 group-hover:rotate-180 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                </svg>
                <span class="htmx-indicator" id="sync-spinner">
                    <svg class="w-3.5 h-3.5 animate-spin" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                </span>
                <span class="sync-text">Sync Twin</span>
            </button>
            {% endif %}
        </div>
        
        {% if ai_content %}
        <div class="flex items-center gap-2 text-xs text-zinc-500">
            <svg class="w-3 h-3 text-emerald-400" fill="currentColor" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="4"/>
            </svg>
            <span>Last synced: {{ doc.twin.last_synced|date:"M d, H:i" }}</span>
        </div>
        {% endif %}
    </div>
    
    <!-- AI Content Display -->
    <div class="flex-1 overflow-y-auto scrollbar-thin">
        {% if ai_content %}
        <div class="p-4">
            <!-- Rendered Markdown Content -->
            <div class="ai-twin-content prose prose-invert prose-sm max-w-none 
                        prose-headings:text-emerald-300 prose-headings:font-semibold
                        prose-h2:text-base prose-h2:mt-4 prose-h2:mb-2 prose-h2:pb-1 prose-h2:border-b prose-h2:border-zinc-800
                        prose-h3:text-sm prose-h3:mt-3 prose-h3:mb-1
                        prose-p:text-zinc-400 prose-p:text-xs prose-p:leading-relaxed prose-p:my-2
                        prose-ul:my-2 prose-ul:text-xs
                        prose-li:text-zinc-400 prose-li:my-0.5
                        prose-code:text-emerald-300 prose-code:bg-zinc-800/50 prose-code:px-1.5 prose-code:py-0.5 prose-code:rounded prose-code:text-xs
                        prose-pre:bg-zinc-900 prose-pre:border prose-pre:border-zinc-800 prose-pre:rounded-lg prose-pre:text-xs
                        prose-strong:text-zinc-200">
                {{ ai_content|safe }}
            </div>
        </div>
        {% else %}
        <!-- Empty State -->
        <div class="flex-1 flex flex-col items-center justify-center text-center px-6 py-12">
            <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-zinc-800 to-zinc-900 border border-zinc-700 flex items-center justify-center mb-4">
                <svg class="w-8 h-8 text-zinc-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                </svg>
            </div>
            <h4 class="text-sm font-medium text-zinc-400 mb-2">No AI Twin Yet</h4>
            <p class="text-xs text-zinc-600 leading-relaxed max-w-xs mb-4">
                Click "Sync Twin" to transform your notes into structured, LLM-optimized markdown.
            </p>
            <div class="text-xs text-zinc-700 space-y-1">
                <p>✦ Extracts technical requirements</p>
                <p>✦ Structures data & logic flows</p>
                <p>✦ Removes conversational fluff</p>
            </div>
        </div>
        {% endif %}
    </div>
    
    <!-- Footer Info -->
    <div class="p-3 border-t border-zinc-800 bg-zinc-900/50">
        <div class="flex items-center gap-2 text-xs text-zinc-600">
            <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            <span>Powered by Claude Sonnet</span>
        </div>
    </div>
</div>

<style>
    /* HTMX loading indicator */
    .htmx-indicator {
        display: none;
    }
    .htmx-request .htmx-indicator {
        display: inline-block;
    }
    .htmx-request .sync-text {
        display: none;
    }
    .htmx-request #sync-icon {
        display: none;
    }
    
    /* AI Twin content styling */
    .ai-twin-content h2 {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .ai-twin-content h2::before {
        content: '◆';
        color: #34d399;
        font-size: 0.5rem;
    }
    
    .ai-twin-content pre {
        overflow-x: auto;
    }
    
    .ai-twin-content pre code {
        background: transparent;
        padding: 0;
    }
</style>

